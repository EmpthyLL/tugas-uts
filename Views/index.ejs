<h1 class="font-bold text-5xl m-2 text-center">Category</h1>
<div id="itemCategory" class="m-4 flex flex-wrap justify-center"></div>

<!-- Product Section -->
<h1 class="font-bold text-5xl m-2 text-center">Products</h1>
<div id="categories" class="font-bold text-xl"></div>

<script>
  function capitalize(string) {
    return string ? string.charAt(0).toUpperCase() + string.slice(1) : string;
  }

  async function fetchProducts() {
    try {
      const response = await fetch('https://dummyjson.com/products?limit=194');
      if (!response.ok) throw new Error('Failed to fetch products');
      const data = await response.json();
      return data.products;
    } catch (error) {
      console.error('Error fetching products:', error);
    }
  }

  function groupByCategory(products) {
    const groupedProducts = {};
    products.forEach(product => {
      const category = product.category;
      if (!groupedProducts[category]) {
        groupedProducts[category] = [];
      }
      groupedProducts[category].push(product);
    });
    return groupedProducts;
  }

  function displayCategories(groupedProducts) {
    const itemCategoryContainer = document.getElementById('itemCategory');
    itemCategoryContainer.innerHTML = '';

    for (const category in groupedProducts) {
      const categoryCard = document.createElement('div');
      categoryCard.className =
        'card w-1/5 m-4 bg-blue-100 rounded-lg shadow-md p-4 text-center cursor-pointer transition-transform transform hover:scale-105';

      const categoryName = document.createElement('h2');
      categoryName.className = 'text-xl font-bold';
      categoryName.innerText = capitalize(category);

      categoryCard.appendChild(categoryName);
      itemCategoryContainer.appendChild(categoryCard);

      categoryCard.addEventListener('click', () => {
        window.location.href = `/category/${category}`;
      });

    }
  }

  function displayProducts(groupedProducts) {
    const categoriesContainer = document.getElementById('categories');
    categoriesContainer.innerHTML = '';

    for (const category in groupedProducts) {
      renderCategory(category, groupedProducts[category]);
    }
  }

  function renderCategory(category, products) {
    const categoriesContainer = document.getElementById('categories');

    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'my-6';

    const categoryTitle = document.createElement('h2');
    categoryTitle.className = 'm-2 text-2xl font-semibold mb-4';
    categoryTitle.innerText = capitalize(category);

    const cardContainer = document.createElement('div');
    cardContainer.className = 'm-2 flex flex-wrap justify-start';

    products.forEach(product => {
      const productCard = document.createElement('div');
      productCard.className = 'card w-1/4 m-2 bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:scale-105';

      const productImage = document.createElement('img');
      productImage.src = product.images[0];
      productImage.alt = product.title;
      productImage.className = 'flex items-center justify-center h-72 w-full object-cover';

      const cardBody = document.createElement('div');
      cardBody.className = 'p-4';

      const productTitle = document.createElement('span');
      productTitle.className = 'font-semibold text-lg mb-1';
      productTitle.innerText = product.title;

      const productPrice = document.createElement('p');
      productPrice.className = 'text-gray-800 text-base';
      productPrice.innerText = `Rp ${Math.floor(
        product.price * 15000
      ).toLocaleString('id-ID')}`;

      cardBody.appendChild(productPrice);
      cardBody.appendChild(productTitle);
      productCard.appendChild(productImage);
      productCard.appendChild(cardBody);

      cardContainer.appendChild(productCard);
    });

    categoryDiv.appendChild(categoryTitle);
    categoryDiv.appendChild(cardContainer);
    categoriesContainer.appendChild(categoryDiv);
  }

  async function initialize() {
    const products = await fetchProducts();
    const groupedProducts = groupByCategory(products);

    displayCategories(groupedProducts);
    displayProducts(groupedProducts);
  }
  document.addEventListener('DOMContentLoaded', initialize);
</script>