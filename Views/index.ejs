<%- include('./components/category') %>

<!-- Product Section -->
<h1 class="font-bold text-5xl m-2 text-center">Products</h1>
<div id="categories" class="font-bold text-xl"></div>

<script>
  function capitalize(string) {
    return string ? string.charAt(0).toUpperCase() + string.slice(1) : string;
  }

  async function fetchProducts() {
    try {
      const response = await fetch("https://dummyjson.com/products?limit=194");
      if (!response.ok) throw new Error("Failed to fetch products");
      const data = await response.json();
      return data.products;
    } catch (error) {
      console.error("Error fetching products:", error);
    }
  }

  function groupByCategory(products) {
    const groupedProducts = {};
    products.forEach((product) => {
      const category = product.category;
      if (!groupedProducts[category]) {
        groupedProducts[category] = [];
      }
      groupedProducts[category].push(product);
    });
    return groupedProducts;
  }

  function displayCategories(groupedProducts) {
    const itemCategoryContainer = document.getElementById("itemCategory");
    itemCategoryContainer.innerHTML = "";

    for (const category in groupedProducts) {
      const categoryCard = `
        <div class="card w-1/5 m-4 bg-blue-100 rounded-lg shadow-md p-4 text-center cursor-pointer transition-transform transform hover:scale-105">
          <h2 class="text-xl font-bold">${capitalize(category)}</h2>
        </div>
      `;

      itemCategoryContainer.insertAdjacentHTML("beforeend", categoryCard);

      itemCategoryContainer.lastChild.addEventListener("click", () => {
        displayProducts(category, groupedProducts);
      });
    }
  }

  function displayProducts(selectedCategory, groupedProducts) {
    const categoriesContainer = document.getElementById("categories");
    categoriesContainer.innerHTML = "";

    for (const category in groupedProducts) {
      renderCategory(category, groupedProducts[category]);
    }
  }

  function renderCategory(category, products) {
    const categoriesContainer = document.getElementById("categories");

    const categoryDiv = `
      <div class="my-6">
        <h2 class="m-2 text-2xl font-semibold mb-4">${capitalize(category)}</h2>
        <div class="m-2 flex flex-wrap justify-start" id="${category}-products">
        </div>
      </div>
    `;

    categoriesContainer.insertAdjacentHTML("beforeend", categoryDiv);

    const cardContainer = document.getElementById(`${category}-products`);

    products.forEach((product) => {
      const productCard = `
        <div class="card w-1/4 m-2 bg-white rounded-lg shadow-md overflow-hidden transition-transform transform hover:scale-105">
          <img src="${product.images[0]}" alt="${
        product.title
      }" class="flex items-center justify-center h-72 w-full object-cover">
          <div class="p-4">
            <span class="font-semibold text-lg mb-1">${product.title}</span>
            <p class="text-gray-800 text-base">Rp ${Math.floor(
              product.price * 15000
            ).toLocaleString("id-ID")}</p>
          </div>
        </div>
      `;

      cardContainer.insertAdjacentHTML("beforeend", productCard);
    });
  }

  async function initialize() {
    const products = await fetchProducts();
    const groupedProducts = groupByCategory(products);

    displayCategories(groupedProducts);
    displayProducts("", groupedProducts);
  }
  document.addEventListener("DOMContentLoaded", initialize);
</script>
