<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto bg-gray-200 p-6 rounded-lg shadow-md">
        <!-- Order History Section -->
        <div>
            <h2 class="text-2xl font-bold mb-6">Order History</h2>
            <% if (user.history && user.history.length > 0) { %>
                <% user.history.forEach(item => { %>
                    <a href="#"></a>
                    <div class="border-b pb-4 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-semibold text-lg">Order History</h3>
                            <% if (item.status) { %>
                                <% if (item.status.toLowerCase() === "delivered") { %>
                                    <span class="text-green-500 font-medium"><%= item.status %></span>
                                <% } else if (item.status.toLowerCase() === "inprocess") { %>
                                    <span class="text-yellow-500 font-medium"><%= item.status %></span>
                                <% } else { %>
                                    <span class="text-red-500 font-medium"><%= item.status %></span>
                                <% } %>
                            <% } else { %>
                                <span class="text-gray-500 font-medium">Unknown Status</span>
                            <% } %>
                        </div>
                        <p class="text-gray-500 mb-2">
                            Order Date: 
                            <%= new Date(item.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %>
                        </p>
                        <% item.cart.items.forEach(product => { %>
                            <div class="flex space-x-4 mb-4">
                                <img src="<%= product.thumbnail %>" alt="<%= product.title %>" class="w-20 h-20 object-cover rounded-md">
                                <div class="flex-1">
                                    <p class="font-semibold"><%= product.title %></p>
                                    <p class="text-gray-500">Category : <%= product.category %></p>
                                    <% if (product.brand) { %>
                                        <p class="text-gray-500">Brand : <%= product.brand %></p>
                                    <% } %>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold">
                                        Rp <%= Math.floor(product.total * 15000).toLocaleString('id-ID') %>
                                    </p>
                                    <p class="text-gray-500">Quantity: <%= product.quantity %></p>
                                </div>
                            </div>
                        <% }) %>
                        <div class="mt-4">
                            <p class="font-semibold">
                                Total: Rp <%= item.cart.total.toLocaleString('id-ID') %>
                            </p>
                            <% if (item.driver) { %>
                                <p class="text-gray-500">
                                    Driver: <%= item.driver.name %> - Vehicle: <%= item.driver.vehicle %>
                                </p>
                            <% } %>
                        </div> 
                    </div>
                <% }) %>
            <% } else { %>
                <p class="text-gray-500">No order history available.</p>
            <% } %>
            
            <% if (user.history && user.history.length > 0) { %>
                <% user.history.forEach(item => { %>
                    <!-- Header History -->
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex flex-column">
                            <img src="/img/logo_A3Mart.png" class="max-w-44" alt="">
                        </div>
                        
                        <p class="text-sm">
                            <%= new Date(item.date).toLocaleDateString('en-US', { day: 'numeric', month: 'short' }) %>, 
                            <%= new Date(item.date).toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true }) %>
                        </p>
                    </div>

                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <% if (item.status) { %>
                                <% if (item.status.toLowerCase() === "delivered") { %>
                                    <span class="text-green-500 font-medium"><%= item.status %></span>
                                <% } else if (item.status.toLowerCase() === "inprocess") { %>
                                    <span class="text-yellow-500 font-medium"><%= item.status %></span>
                                <% } else { %>
                                    <span class="text-red-500 font-medium"><%= item.status %></span>
                                <% } %>
                            <% } else { %>
                                <span class="text-gray-500 font-medium">Unknown Status</span>
                            <% } %>
                        </div>
                        <p class="text-gray-500 mb-2 text-sm"><%= item.uuid %></p>
                    </div>
                    <hr class="border-gray-400 dark:border-gray-700">
                    
                    <!-- Rate Driver -->
                    <div class="flex flex-col items-center justify-center">
                        <p class="mt-3 text-xl text-center font-bold">How was the driver?</p>
                        <button class="mt-2 mb-3">
                            <ion-icon name="star" id="star1" class="text-4xl text-gray-400" onclick="change(star1)"></ion-icon>
                            <ion-icon name="star" id="star2" class="text-4xl text-gray-400" onclick="change(star2)"></ion-icon>
                            <ion-icon name="star" id="star3" class="text-4xl text-gray-400" onclick="change(star3)"></ion-icon>
                            <ion-icon name="star" id="star4" class="text-4xl text-gray-400" onclick="change(star4)"></ion-icon>
                            <ion-icon name="star" id="star5" class="text-4xl text-gray-400" onclick="change(star5)"></ion-icon>
                        </button>
                    </div>
                    <hr class="border-gray-400 dark:border-gray-700">
                        
                    <!-- Driver Info -->
                    <div class="flex items-center">
                        <img src="/img/uploads/ProfilePic/1731170059164.jpg" alt="Profile" class="mt-5 rounded-full w-20 h-20">

                        <div class="ml-2 mt-3">
                            <p class="text-gray-500"><%= item.driver.vehicle %></p>
                            <p class="font-bold text-lg"><%= item.driver.name %></p>
                            
                        </div>
                    </div>
                    <hr class="mt-3 border-gray-400 dark:border-gray-700">
                    
                    <!-- Detail Location -->
                    <p class="text-gray-700 font-bold my-3">Delivery Details</p>
                    <div class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="0 0 24 24" fill="none" stroke="#f77102" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-dot"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>

                        <div class="ml-3">
                            <p class="text-sm text-gray-400">Delivery Location</p>
                            <p class="font-bold text-lg">Ajinomoto Home</p>
                        </div>
                    </div>
                    <hr class="mt-3 border-gray-400 dark:border-gray-700">

                    <!-- Shopping List -->
                    <p class="text-gray-700 font-bold my-3">Shopping List</p>
                        <% cart.items.forEach(item => { %>
                            <div class="flex justify-between">
                                <p><%= item.quantity %> X <%= item.title %></p>
                                <p>Rp <%= Math.floor(item.price *
                            15000).toLocaleString("id-ID") %></p>
                            </div>
                            <hr class="my-3 border-gray-300 dark:border-gray-400">
                        <% }) %>
                    

                    <!-- contoh manual -->
                    <div class="flex justify-between">
                        <p>3 X Egg</p>
                        <p>Rp 60000</p>
                    </div>
                    <hr class="my-3 border-gray-300 dark:border-gray-400">

                    <div class="flex justify-between">
                        <p>3 X Egg</p>
                        <p>Rp 60000</p>
                    </div>
                    <!-- batas contoh manual -->

                    <!-- Detail Payment -->


                <% }) %>
            <% } else { %>
                <p class="text-gray-500">No order history available.</p>
            <% } %>

        </div>
    </div>
</body>

<script>
    const change = (clicked) => {
        const stars = [
            document.getElementById('star1'),
            document.getElementById('star2'),
            document.getElementById('star3'),
            document.getElementById('star4'),
            document.getElementById('star5'),
        ];

        let isGray = clicked.classList.contains('text-gray-400');

        stars.forEach((star, index) => {
            if (index <= stars.indexOf(clicked)) {
                star.classList.remove('text-gray-400');
                star.classList.add('text-yellow-500');
            } else {
                star.classList.remove('text-yellow-500');
                star.classList.add('text-gray-400');
            }
        });

        if (!isGray) {
            clicked.classList.remove('text-yellow-500');
            clicked.classList.add('text-gray-400');
        }
    };
</script>